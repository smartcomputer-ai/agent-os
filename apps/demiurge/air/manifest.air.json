{
  "$kind": "manifest",
  "schemas": [
    {
      "name": "demiurge/ChatRole@1"
    },
    {
      "name": "demiurge/ChatId@1"
    },
    {
      "name": "demiurge/TokenUsage@1"
    },
    {
      "name": "demiurge/ChatMessage@1"
    },
    {
      "name": "demiurge/ChatState@1"
    },
    {
      "name": "demiurge/PendingOutput@1"
    },
    {
      "name": "demiurge/ChatCreated@1"
    },
    {
      "name": "demiurge/UserMessage@1"
    },
    {
      "name": "demiurge/ChatRequest@1"
    },
    {
      "name": "demiurge/ToolCall@1"
    },
    {
      "name": "demiurge/ChatResult@1"
    },
    {
      "name": "demiurge/ToolCallRequested@1"
    },
    {
      "name": "demiurge/ToolResult@1"
    },
    {
      "name": "demiurge/ChatEvent@1"
    },
    {
      "name": "sys/BlobGetParams@1"
    },
    {
      "name": "sys/BlobGetReceipt@1"
    },
    {
      "name": "sys/BlobGetResult@1"
    },
    {
      "name": "sys/LlmToolChoice@1"
    },
    {
      "name": "sys/LlmGenerateParams@1"
    },
    {
      "name": "sys/LlmGenerateReceipt@1"
    },
    {
      "name": "sys/SecretRef@1"
    },
    {
      "name": "sys/TextOrSecretRef@1"
    },
    {
      "name": "sys/BytesOrSecretRef@1"
    }
  ],
  "modules": [
    {
      "name": "demiurge/Demiurge@1"
    },
    {
      "name": "sys/CapEnforceLlmBasic@1"
    }
  ],
  "plans": [
    {
      "name": "demiurge/chat_plan@1"
    }
  ],
  "caps": [
    {
      "name": "demiurge/llm_basic@1"
    }
  ],
  "policies": [
    {
      "name": "demiurge/llm_policy@1"
    }
  ],
  "secrets": [
    {
      "name": "llm/api@1"
    }
  ],
  "defaults": {
    "policy": "demiurge/llm_policy@1",
    "cap_grants": [
      {
        "name": "cap_llm",
        "cap": "demiurge/llm_basic@1",
        "params": {
          "record": {
            "models": {
              "set": [
                {
                  "text": "gpt-4o-mini"
                }
              ]
            },
            "max_tokens": {
              "nat": 2048
            }
          }
        }
      },
      {
        "name": "blob_grant",
        "cap": "sys/blob@1",
        "params": {
          "record": {}
        }
      }
    ]
  },
  "module_bindings": {
    "demiurge/Demiurge@1": {
      "slots": {
        "blob": "blob_grant"
      }
    }
  },
  "routing": {
    "events": [
      {
        "event": "demiurge/ChatEvent@1",
        "reducer": "demiurge/Demiurge@1",
        "key_field": "$value.chat_id"
      },
      {
        "event": "sys/BlobGetResult@1",
        "reducer": "demiurge/Demiurge@1"
      }
    ],
    "inboxes": []
  },
  "triggers": [
    {
      "event": "demiurge/ChatRequest@1",
      "plan": "demiurge/chat_plan@1",
      "correlate_by": "request_id"
    }
  ],
  "air_version": "1",
  "effects": [
    {
      "name": "sys/llm.generate@1"
    },
    {
      "name": "sys/blob.get@1"
    }
  ]
}
