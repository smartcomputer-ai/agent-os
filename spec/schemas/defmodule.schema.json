{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aos.dev/air/v1/defmodule.schema.json",
  "title": "AIR v1 defmodule",
  "type": "object",
  "properties": {
    "$kind": { "const": "defmodule" },
    "name": { "$ref": "common.schema.json#/$defs/Name" },
    "module_kind": { "type": "string", "enum": ["reducer","pure"] },
    "wasm_hash": { "$ref": "common.schema.json#/$defs/Hash" },
    "key_schema": { "$ref": "common.schema.json#/$defs/SchemaRef" },
    "abi": {
      "type": "object",
      "properties": {
        "reducer": {
          "type": "object",
          "properties": {
            "state": { "$ref": "common.schema.json#/$defs/SchemaRef" },
            "event": { "$ref": "common.schema.json#/$defs/SchemaRef" },
            "annotations": { "$ref": "common.schema.json#/$defs/SchemaRef" },
            "effects_emitted": {
              "type": "array",
              "items": { "$ref": "common.schema.json#/$defs/EffectKind" }
            },
            "cap_slots": {
              "type": "object",
              "description": "slot_name â†’ cap_type",
              "patternProperties": {
                "^[A-Za-z_][A-Za-z0-9_.-]{0,63}$": { "$ref": "common.schema.json#/$defs/CapType" }
              },
              "additionalProperties": false
            }
          },
          "required": ["state","event"],
          "additionalProperties": false
        },
        "pure": {
          "type": "object",
          "properties": {
            "input": { "$ref": "common.schema.json#/$defs/SchemaRef" },
            "output": { "$ref": "common.schema.json#/$defs/SchemaRef" }
          },
          "required": ["input","output"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["$kind","name","module_kind","wasm_hash","abi"],
  "allOf": [
    { "if": { "properties": { "module_kind": { "const": "reducer" } } },
      "then": { "required": ["abi"], "properties": { "abi": { "required": ["reducer"] } } } },
    { "if": { "properties": { "module_kind": { "const": "pure" } } },
      "then": { "required": ["abi"], "properties": { "abi": { "required": ["pure"] } } } }
  ],
  "additionalProperties": false
}
